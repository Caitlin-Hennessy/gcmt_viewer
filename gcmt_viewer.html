<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>GCMT viewer</title>
<meta name='viewport' 
      content='initial-scale=1,maximum-scale=1,user-scalable=no' />

<script 
  src='https://api.tiles.mapbox.com/mapbox.js/v2.1.5/mapbox.js'>
</script>

<link 
  href='https://api.tiles.mapbox.com/mapbox.js/v2.1.5/mapbox.css' 
   rel='stylesheet' />

<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>

</head>
<body>
<div id='map'></div>

<script>
L.mapbox.accessToken = 'pk.eyJ1IjoiY29zc2F0b3QiLCJhIjoiVGJyMGU5cyJ9.CMKdx74guBSUyyC-L1fAoA';
var map = L.mapbox.map('map', 'examples.map-i86nkdio', {
    minZoom: 3,
    // These options apply to the tile layer in the map.
    tileLayer: {
        // This map option disables world wrapping. by default, it is false.
        continuousWorld: false,
        // This option disables loading tiles outside of the world bounds.
        noWrap: true
        }
    }).setView([48.103803, -121.965733], 7);


var gcmt6_url = 'http://earth-analysis.com/gcmt_viewer/data/gcmt_icons_60plus.geojson';

var gcmt55_url = 'http://earth-analysis.com/gcmt_viewer/data/gcmt_icons_55plus.geojson';

var gcmt6 = L.mapbox.featureLayer()
      .loadURL(gcmt6_url);
      //.addTo(map);

  gcmt6.on('layeradd', function(e) {
      var marker = e.layer,
          feature = marker.feature;

      marker.setIcon(L.icon(feature.properties.icon));

      });


gcmt6.addTo(map);

// var gcmt55_url = 'http://earth-analysis.com/gcmt_viewer/data/gcmt_icons_60plus.geojson';
// 
// var gcmt55 = L.mapbox.featureLayer()
//       .loadURL(gcmt55_url);
//       //.addTo(map);
// 
//   gcmt55.on('layeradd', function(e) {
//       var marker = e.layer,
//           feature = marker.feature;
// 
//       marker.setIcon(L.icon(feature.properties.icon));
// 
//       });
// 
//   //gcmt6.on('layeradd', function() {
//   //    if (map.getZoom() 
// 
//   gcmt6.on('ready', function(e) {
//       var popupContent6 = e.layer,
//           feature = popupcontent6.feature;
// 
// 
//       var popupContent6 = '<h2>Event: ' + e.layer.feature.properties.event_name + '<\/h2>' +
//           '<p>Mwc: ' + e.layer.feature.properties.Mwc + '<br \/>' +
//           'Depth: ' + e.layer.feature.properties.depth + '\/p>';
// 
//       layer.bindPopup(popupContent6)
// 
//       });
// 
// 
// 
//   gcmt55.addTo(map);
// 
// map.on('zoomend', function() {
// 
//     if (map.getZoom() <= 7.5) {
//       gcmt6.setFilter(function() { return true; });
//      gcmt55.setFilter(function() { return false; });
// 
//       } else {
//       gcmt6.setFilter(function() { return false; });
//      gcmt55.setFilter(function() { return true; });
//     }
// });

</script>
</body>
</html>
