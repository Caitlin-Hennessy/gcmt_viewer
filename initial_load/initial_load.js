var MongoClient = require("mongodb").MongoClient;
var fs = require("fs");

var url = "mongodb://admin:segfault@ds145355.mlab.com:45355/gcmt_dev?connectionTimeoutMS=360000000&socketTimeoutMS=360000000";

MongoClient.connect(url, function(err, db) {
  if (err) {
    console.log("ERROR");
    throw err;
  }

//  var filenames = ["ATA", "gcmt_icons_reduced", "HimaTibetMap", "plate_bounds_bird02"];
  var filenames = ["gcmt_icons_reduced"];
  
  var startTime = process.hrtime()[0];

  db.collection("caitlintestcollection").deleteMany({}, (err, res) => {
    console.log("Starting inserts");

    filenames.map((filename) => {
      var json = JSON.parse(fs.readFileSync("./data/" + filename + ".geojson", "utf8"));

      var features = json.features;
      var base64iconUrl = 'data:image/png;base64,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';
      features.map((feature) => {
        feature.properties.icon.iconUrl = base64iconUrl;
      });

      console.log("Starting to insert " + filename);
      db.collection("caitlintestcollection").insertMany(features, (err, res) => {
        if (err) throw err;
        var totalTime = process.hrtime()[0] - startTime;
        console.log("All entries from " + filename + " inserted ok. Elapsed time is " + totalTime + " seconds.");
      });
    });
  })
});
